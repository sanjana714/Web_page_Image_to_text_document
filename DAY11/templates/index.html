<!DOCTYPE html>

<html lang="en">

<head>

    <meta charset="UTF-8">

    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <title>IMAGE CONFIG</title>

    <link rel="stylesheet" href="static/styles1.css">

    <script src="https://code.jquery.com/jquery-3.5.1.min.js">

        function extractText() {

            let filename = $("#originalImageDisplay").attr("src").split('/').pop();

            $.ajax({

                type: "GET",

                url: `/get_image_info/${filename}`,

                success: function(response) {

                    $("#extractedTextDisplay").val(response.text);

                }

            });

        }

 

    </script>

    <script>

        function showImage(filename) {
            // Clear the extracted text
            $("#extractedTextDisplay").val("");

            $.ajax({
                type: "GET",
                url: `/get_image_info/${filename}`,
                success: function(response) {
                    $("#originalImageDisplay").attr("src", `/get_image/${response.original}`);
                    $("#imageDisplay").attr("src", `/get_image/${response.processed}`);
                }
            });
        }

 

        function handleFolderPick() {

            const files = document.getElementById('folderPicker').files;

            let pngFiles = [];

            let formData = new FormData();

 

            console.log("Total files in folder:", files.length);  // Debug message

 

            // Filter out only .png files from the list

            for (let i = 0; i < files.length; i++) {

                if(files[i].name.endsWith('.png')) {

                    pngFiles.push(files[i].webkitRelativePath);

                    formData.append('files', files[i]);

                }

                if(files[i].name.endsWith('.jpg')) {

                    pngFiles.push(files[i].webkitRelativePath);

                    formData.append('files', files[i]);

                }

            }

 

            console.log("PNG,JPG files found:", pngFiles.length);  // Debug message

 

            $.ajax({

                type: "POST",

                url: "/upload_files",

                data: formData,

                processData: false,

                contentType: false,

                success: function(response) {

                    if(response.error) {

                        alert(response.error);

                        return;

                    }

                    $("#fileList").empty();

                    pngFiles.forEach(file => {

                        let fileName = file.split('/').pop();

                        $("#fileList").append(`<li onclick="showImage('${fileName}')">${fileName}</li>`);

                    });

                }

            });

        }

   

        function extractText() {

            let filename = $("#originalImageDisplay").attr("src").split('/').pop();

            $.ajax({

                type: "GET",

                url: `/get_image_info/${filename}`,

                success: function(response) {

                    $("#extractedTextDisplay").val(response.text);

                }

            });

        }

        function downloadFile(filename, content) {

            // It works on all HTML5 Ready browsers as it uses the download attribute of the <a> element:

            const element = document.createElement('a');

 

            //A blob is a data type that can store binary data

            // "type" is a MIME type

            // It can have a different value, based on a file you want to save

            const blob = new Blob([content], { type: 'plain/text' });

 

            //createObjectURL() static method creates a DOMString containing a URL representing the object given in the parameter.

            const fileUrl = URL.createObjectURL(blob);

 

            //setAttribute() Sets the value of an attribute on the specified element.

            element.setAttribute('href', fileUrl); //file location

            element.setAttribute('download', filename); // file name

            element.style.display = 'none';

 

            //use appendChild() method to move an element from one element to another

            document.body.appendChild(element);

            element.click();

 

            //The removeChild() method of the Node interface removes a child node from the DOM and returns the removed node

            document.body.removeChild(element);

            };

 

            window.onload = () => {

            document.getElementById('download').

            addEventListener('click', e => {

 

                //The value of the file name input box

                const filename = document.getElementById('filename').value;

 

                //The value of what has been input in the textarea

                const content = document.getElementById('extractedTextDisplay').value;

 

                // The && (logical AND) operator indicates whether both operands are true. If both operands have nonzero values, the result has the value 1 . Otherwise, the result has the value 0.

 

                if (filename && content) {

                downloadFile(filename, content);

                }

            });

            };

    </script>

</head>

<body>

    <div id="div1">
        IMAGE PROCESSOR
    </div>

    <div id="div2">
        <section class="center-section">

            <label for="folderPicker">Browse Folder:</label>
    
            <input type="file" id="folderPicker" webkitdirectory directory multiple onchange="handleFolderPick()">
    
        </section>
    </div>
    

    <!-- Part3 -->
    <div id="div3">
        <textarea id="extractedTextDisplay" rows="25" cols="100"></textarea>

        <input id="filename" placeholder="Specify a filename..." />
        <br>
        <button id="download" style="font-size: 18px; background-color: rgb(168, 103, 179); color: white;">Download file</button>
        <br>

        <!-- Add a "Clear" button -->
        <button id="clearText" style="font-size: 18px; background-color: rgb(168, 103, 179); color: white;">Clear Text</button>
    </div>



    <!-- Part1 -->
    <div id="div4">
        <ul id="fileList"></ul>
        <div id="div7">
            <button id="extractButton" onclick="extractText()" style="font-size: 18px; background-color: rgb(168, 103, 179); color: white;">Extract Text</button>
            <!-- Add an Undo button -->
            <button id="undoButton" style="font-size: 18px; background-color: rgb(168, 103, 179); color: white;">Undo</button>
        </div>
    </div>

    <!-- Part2 -->
    <div id="div5">
        <div id="div10">
            <div>
                <!-- Original Image display area -->
                <div class="image-container">
                    <img id="originalImageDisplay" src="">
                </div>
            </div>
            
            <!-- Grayscale Image display area -->
            <div class="grayscaleimage-container" style="overflow: auto; height: 225px;">
                <img id="imageDisplay" src="">
            </div>       
        </div>
        <div id="div6">            
            <button type="button" onclick="zoomin()" style="font-size: 14px; background-color: rgb(168, 103, 179); color: white;">

                Zoom-In

            </button>

             

            <button type="button" onclick="zoomout()" style="font-size: 14px; background-color: rgb(168, 103, 179); color: white;">

                Zoom-Out

            </button>

            <button type="button" onclick="rotateClockwise()" style="font-size: 14px; background-color: rgb(168, 103, 179); color: white;">

                Rotate Clockwise

            </button>
    
            <button type="button" onclick="rotateCounterClockwise()" style="font-size: 14px; background-color: rgb(168, 103, 179); color: white;">

                Rotate Anti-Clockwise

            </button>
    

            <script type="text/javascript">

                var rotationAngle = 0; // Initialize rotation angle

                function zoomin() {
                    var processedImage = document.getElementById("imageDisplay");
                    processedImage.style.width = (processedImage.clientWidth * 1.1) + "px";
                    processedImage.style.height = (processedImage.clientHeight * 1.1) + "px";
                }

                function zoomout() {
                    var processedImage = document.getElementById("imageDisplay");
                    processedImage.style.width = (processedImage.clientWidth / 1.1) + "px";
                    processedImage.style.height = (processedImage.clientHeight / 1.1) + "px";
                }


                function rotateClockwise() {
                    rotationAngle += 90; // Increment the rotation angle
                    rotateImages();
                }

                function rotateCounterClockwise() {
                    rotationAngle -= 90; // Decrement the rotation angle
                    rotateImages();
                }

                function rotateImages() {
                    var processedImage = document.getElementById("imageDisplay");

                    // Apply the rotation transformation
                    processedImage.style.transform = `rotate(${rotationAngle}deg)`;

                    // Adjust the image container size to fit the rotated image
                    var processedContainer = document.querySelector("#imageDisplay .image-container");

                    // Reset the container size before getting the natural image size
                    processedContainer.style.width = "auto";

                    // Get the natural image size after rotation
                    var processedWidth = processedImage.naturalWidth;
                    var processedHeight = processedImage.naturalHeight;

                    // Update the container size to fit the rotated image
                    processedContainer.style.width = processedWidth + "px";

                    // Update the division height to fit the larger of the two images
                    var division = document.getElementById("div5");
                    var maxHeight = processedHeight;
                    division.style.height = maxHeight + "px";
                }

                // Add this function to clear the text area
                function clearText() {
                    $("#extractedTextDisplay").val(""); // Clear the text area
                }

                // Add an event listener for the "Clear" button click
                $("#clearText").click(function () {
                    clearText();
                });

                // ...

                window.onload = () => {
                    // ...
                    document.getElementById('download').
                    addEventListener('click', e => {
                        const filename = document.getElementById('filename').value;
                        const content = document.getElementById('extractedTextDisplay').value;

                        if (filename && content) {
                            downloadFile(filename, content);
                        }
                    });

                    // Add an event listener for the "Clear" button click
                    document.getElementById('clearText').addEventListener('click', clearText);
                };

                document.getElementById('undoButton').addEventListener('click', function () {
                    // Use window.location.reload() to refresh the page
                    window.location.reload();
                });

            </script>
        </div>
    </div>

</body>

</html>

 